<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title></title>
		<link rel="stylesheet" href="css/main.css" />
		<script src="js/jquery.min.js"></script>
		<script src="js/raphael.js"></script>
    </head>
    <body>
	<div class="header">
		<h3>Line Charts</h3>
	</div>
	<div class="container">
		<div class="inner-container" >
			<div class="graph" id="cntnr1"></div>
		</div>
	</div>
	<script>
		window.onload = function(){
			var elems = {}, data = [{
					month : '1900',
					value : {
						tiger : 26,
						lion : 13,
						deer : 65,
					}
				},{
					month : '1910',
					value : {
						tiger : 29,
						lion : 17,
						deer : 80,
					}
				},{
					month : '1920',
					value : {
						tiger : 35,
						lion : 20,
						deer : 25,
					}
				},{
					month : '1930',
					value : {
						tiger : 40,
						lion : 27,
						deer : 45,
					}
				},{
					month : '1940',
					value : {
						tiger : 43,
						lion : 35,
						deer : 10,
					}
				},{
					month : '1950',
					value : {
						tiger : 40,
						lion : 31,
						deer : 30,
					}
				},{
					month : '1960',
					value : {
						tiger : 10,
						lion : 50,
						deer : 30,
					}
				},{
					month : '1970',
					value : {
						tiger : 32,
						lion : 23,
						deer : 9,
					}
				},{
					month : '1980',
					value : {
						tiger : 28,
						lion : 17,
						deer : 10,
					}
				},{
					month : '1990',
					value : {
						tiger : 25,
						lion : 12,
						deer : 30,
					}
				},{
					month : '2000',
					value : {
						tiger : 21,
						lion : 9,
						deer : 50,
					}
				},{
					month : '2010',
					value : {
						tiger : 16,
						lion : 5,
						deer : 60,
					}
				}
			];
			var instruction = {
				title : "Wildlife population",
				width : 1000,
				height : 540,
				paddingx : 40,
				paddingy : 40,
				axis_color : "#9d9d9d",
				x_axis_name : "Year",
				y_axis_name : "Population in thousand",
				x_division_no : "",//"" means Number of data
				y_division_no : "10",//"" means Number of data
				path_no : 3,
			};
			path_details = [{
				name : "Tiger",
				color : "#ff0000",
			},{
				name : "Lion",
				color : "#00e396",
			},{
				name : "Deer",
				color : "#008ffb",
			}];
			var flag = 0;
			if(parseInt(instruction.path_no)==path_details.length){
				for(var i = 0 ; i<data.length; i++){
					if(Object.keys(data[i].value).length == path_details.length){
						flag = 1;
					}else{
						flag = 0;
					}
				}
				if(flag == 0){
					alert("Check the data values");
				}
			}else{
				alert("Check the path no and path details");
			}
			if(flag === 1){						
				//Default paper width, height
				//Max width : 1000, Max-height : 540
				//Min width : 780,  Min-height : 400
				//Max padding : 40
				//Min padding : 25
				var width = parseInt(instruction.width) > 1000 ? 1000 : parseInt(instruction.width) < 780 ? 780 : parseInt(instruction.width) || 1000;
				var height = parseInt(instruction.height) > 540 ? 540 : parseInt(instruction.height) < 420 ? 420 : parseInt(instruction.height) || 540;
				var paddingx = parseInt(instruction.paddingx) > 40 ? 40 : parseInt(instruction.paddingx) < 25 ? 25 : parseInt(instruction.paddingx) || 40;
				var paddingy = parseInt(instruction.paddingy) > 40 ? 40 : parseInt(instruction.paddingy) < 25 ? 25 : parseInt(instruction.paddingy) || 40;
				var axis_color = instruction.axis_color || "#000";
				var x_division_no = parseInt(instruction.x_division_no) || data.length;
				var y_division_no = parseInt(instruction.y_division_no) || data.length;
				
				var paper = new Raphael(document.getElementById("cntnr1"), width, height);
				
				//All title
				paper.text((2*paddingx), paddingy, instruction.title).attr({
					'font-weight' : 'bold',
					'text-anchor': 'start',
					'font-size' : '15px',
				});
				var x = (2*paddingx);
				for(var i = 0; i < path_details.length; i++){
					x += (7*path_details[(path_details.length-1)-i].name.length);
					paper.text(width - x, paddingy, path_details[(path_details.length-1)-i].name).attr({
					'font-weight' : 'bold',
					'text-anchor': 'start',
					'font-size' : '13px',
					fill : path_details[(path_details.length-1)-i].color,
					});
					paper.circle(width- x - (.3*paddingx) , paddingy, 5).attr({
						fill : path_details[(path_details.length-1)-i].color,
						stroke : path_details[(path_details.length-1)-i].color,
					});
					x += .75*paddingx;
				}
				paper.text(width/2, height-paddingy, instruction.x_axis_name);
				paper.text(paddingx, height/2, instruction.y_axis_name).attr({
					transform : "r270",
				});
				
				//Draw the axis
				paper.path("M " + (2*paddingx) + " " + (2*paddingy) +" l  0 " + (height-(4*paddingy)) + "l "+ (width - (4*paddingx)) + " 0").attr({
					stroke : axis_color,
				});
				/* x */
				for(var i = 0; i< x_division_no; i++){
					paper.path( "M " + ((2*paddingx) + ((width-(4*paddingx))/(x_division_no-1))*i) + " "+ (height - (2*paddingy)) + " l 0 3" ).attr({
						stroke : instruction.axis_color,
					});
					paper.text(((2*paddingx) + ((width-(4*paddingx))/(x_division_no-1))*i) , (height - (1.5*paddingy)), data[i].month).attr({
						fill : instruction.axis_color,
					});
					paper.path("M " + ((2*paddingx) + ((width-(4*paddingx))/(x_division_no-1))*i) + " "+ (height - (2*paddingy)) + " l 0 " + (-(height-(4*paddingy))) ).attr({
						stroke : "#ececec",
					});
				}
				/* y */
				var max = 0;
				for(var i = 0; i<data.length; i++){
					if((Math.max(...(Object.values(data[i].value))))>max){
						max = Math.max(...(Object.values(data[i].value)));
					}
				}
				max = ((Math.ceil(max/(y_division_no-1)))*(y_division_no-1))+(y_division_no-1);				
				for(var i = 0 ; i<y_division_no ; i++){
					paper.path( "M "+ 2*paddingx +" " + ( (height-(2*paddingy))-((height-(4*paddingy))/(y_division_no-1))*i ) + " l -3 0").attr({
						stroke : instruction.axis_color,
					});
					paper.text(2*paddingx - 5, (height-(2*paddingy))-((height-(4*paddingy))/(y_division_no-1))*i, (max/(y_division_no-1))*i).attr({
						fill : instruction.axis_color,
						'text-anchor' : "end",
					});
					paper.path( "M "+ 2*paddingx +" " + ( (height-(2*paddingy))-((height-(4*paddingy))/(y_division_no-1))*i ) + " l "+  (width-(4*paddingx)) +" 0").attr({
						stroke : "#ececec",
					});
				}
				
				
				//Draw path
				for(var i = 0; i < parseInt(instruction.path_no); i++){
					var p = "M "+ (2*paddingx) + " "+ (height-(2*paddingy))+" l " + (width - (4*paddingx))+ " 0";
					var path1 = paper.path(p).attr({
						'stroke-width' : 4,
						stroke : path_details[i].color,
						opacity : 0,
					});
					p = "M "+ (2*paddingx) + " "+ ( (height-(2*paddingy)) - ((height-(4*paddingy))*(Object.values(data[0].value)[i]))/max) + " ";
					for(var j = 1; j < data.length ; j++){
						p += " l "+ (width-(4*paddingx))/(x_division_no-1) + " "+ ((height-(4*paddingy))*(Object.values(data[j-1].value)[i] - Object.values(data[j].value)[i]))/max + "";
					}
					path1.animate({
						path : p,
						opacity : 1,
					}, 500, "<>");
				}
				
				//Draw popup
				var pop_rect = paper.rect(0, 0, 100, instruction.path_no*30, 7).attr({
					fill : '#333333',
					stroke : '#f1f1f1',
					opacity : 0,
				});
				for(var i=0; i<instruction.path_no; i++){
					var text1 = paper.text(20, (15 + (30*i)), "").attr({
						fill : path_details[i].color,
						'font-size' : '13px',
						'text-anchor' : 'start',
						'font-weight' : 'bold',
						opacity : 0,
					});
					elems["tt"+i] = text1;
				}
				
				//Draw circle
				for(var i = 0; i < parseInt(instruction.path_no); i++){
					for(var j = 0; j < data.length ; j++){
						var circle = paper.circle( ((2*paddingx)+j*((width-(4*paddingx))/(x_division_no-1))), (height - (2*paddingy)) - ((Object.values(data[j].value)[i])*((height-(4*paddingy))/max)) ,3);
						circle.attr({
							fill : path_details[i].color,
							stroke : path_details[i].color,
							opacity : 0,
						});
						circle.node.id = "c"+i+""+j;
					}
				}
				//Collect max data on every point for view popup on that point
				var popup_point_x = [];
				var popup_point_y = [];
				for(var i = 0; i < data.length; i++){
					popup_point_x.push(((2*paddingx)+i*((width-(4*paddingx))/(x_division_no-1))));
					popup_point_y.push((height - (2*paddingy)) - ((Math.max(...Object.values(data[i].value)))*((height-(4*paddingy))/max)));
				}
				//Draw rectangle
				for(var i = 0; i< data.length; i++){
					var rect = paper.rect((((2*paddingx)-(((width-(4*paddingx))/(x_division_no-1))/2))+i*((width-(4*paddingx))/(x_division_no-1))),2*paddingy,((width-(4*paddingx))/(x_division_no-1)),(height - (4*paddingy)));
					rect.attr({
						fill : "transparent",
						opacity : 0,
					});
					rect.node.id = "r"+i;
					rect.node.addEventListener('mouseover', popup);
					rect.node.addEventListener('mouseout', popdown);
				}
				function popup(){
					var id = parseInt(this.id.replace('r',''));
					//for circle
					for(var i = 0; i<parseInt(instruction.path_no); i++){
						$('#c'+i+''+id).animate({
							opacity : 1,
							r : 4,
						},150);
					}	
					if(id<data.length/2){
						//for rect
						pop_rect.animate({
							opacity : 1,
							x : popup_point_x[id] ,
							y : popup_point_y[id] - (instruction.path_no*30),
						},150);
						//for text change
						for(var i = 0; i<parseInt(instruction.path_no); i++){
							elems["tt"+i].attr({
								text : path_details[i].name+" : "+Object.values(data[id].value)[i],
							});
						}
						//for text animation
						for(var i = 0; i<parseInt(instruction.path_no); i++){
							elems["tt"+i].animate({
								opacity : 1,
								x : popup_point_x[id] + 20,
								y : popup_point_y[id] + (15 + (30*i)) - (instruction.path_no*30),
							}, 150);
						}
					}else{
						//for rect
						pop_rect.animate({
							opacity : 1,
							x : popup_point_x[id] - 100,
							y : popup_point_y[id] - (instruction.path_no*30),
						},150);
						//for text change
						for(var i = 0; i<parseInt(instruction.path_no); i++){
							elems["tt"+i].attr({
								text : path_details[i].name+" : "+Object.values(data[id].value)[i],
							});
						}
						//for text animation
						for(var i = 0; i<parseInt(instruction.path_no); i++){
							elems["tt"+i].animate({
								opacity : 1,
								x : popup_point_x[id] + 20 - 100,
								y : popup_point_y[id] + (15 + (30*i)) - (instruction.path_no*30),
							}, 150);
						}
					}
				}
				function popdown(){
					var id = parseInt(this.id.replace('r',''));
					for(var i = 0; i<parseInt(instruction.path_no); i++){
						$('#c'+i+''+id).animate({
							opacity : 0,
							r : 4,
						}, 100);
					}
					//for rect
					pop_rect.animate({
						opacity : 0,
					}, 150);
					//for text
					for(var i = 0; i<parseInt(instruction.path_no); i++){
						elems["tt"+i].animate({
							opacity : 0,
						}, 150);
					}
				}
				
			}			
		}
	</script>
    </body>
</html>
