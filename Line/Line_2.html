<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title></title>
		<link rel="stylesheet" href="css/main.css" />
        <script src="js/raphael.js"></script>   		
        <script src="js/jquery.min.js"></script>   		
		<!--<link href="https://fonts.googleapis.com/css?family=Open+Sans:300" rel="stylesheet">-->
    </head>
    <body>
	<div class="header">
		<h3>Line Charts</h3>
	</div>
	<div class="container">
		<div class="inner-container" >
			<div class="graph" id="cntnr1"></div>
			<div class="btn-div"><input class="btn" type="submit" value="Run" id="btn1"></div>
		</div>
	</div>
	<script>
		var month = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec',];
		var high = [18, 23, 28, 36, 39, 37, 34, 33, 33, 31, 27, 21];
		var low =  [7, 11, 15, 22, 26, 27, 27, 26, 24, 19, 13, 8];
		var color = ['#008ffb', '#00e396'];
		var options = {
			name : "Average High & Low temperature",
			xname : "Month",
			yname : "Temperature",
			height : "460",
			width : "1000",
			paddingx : "40",
			paddingy : "40",
			x : "",
			y : 8,
			path_name_1 : "High",
			path_name_2 : "Low",
		};		
		//Default paper width, height
		//Max width : 1000, Max-height : 500
		var paddingx = parseInt(options.paddingx) > 40 ? 40 : parseInt(options.paddingx) || 40;
		var paddingy = parseInt(options.paddingy) > 40 ? 40 : parseInt(options.paddingy) || 40;		
		var width = parseInt(options.width) < 700 ? 700 : (parseInt(options.width) > 920 ? 920 : parseInt(options.width)) || 700;
		var height = parseInt(options.height) < 400 ? 400 : (parseInt(options.height) > 460 ? 460 : parseInt(options.height)) || 400;
		width += (paddingx*2);
		height += (paddingy*2);		
		var paper = new Raphael(document.getElementById('cntnr1'), width, height);	
		//Check the all data length
		if(month.length==high.length){
			if(month.length==low.length){
				//Write name of chart
				paper.text(2*paddingx, paddingy, options.name).attr({
					'font-weight' : 'bold',
					'text-anchor': 'start',
					'font-size' : '15px',
				});
				paper.text(width/2, height-paddingy, options.xname);
				paper.text(paddingx, height/2, options.yname).attr({
					transform : 'r270',
				});
				paper.circle((width/1.25)-10,paddingy*1.25,5).attr({
					stroke : color[0],
					fill : color[0],
				});
				paper.text(width/1.25,paddingy*1.25,options.path_name_1).attr({
					fill : color[0],
					'font-weight' : 'bold',
					'text-anchor': 'start',
					'font-size' : '13px',
				});
				paper.circle((width/1.15)-10,paddingy*1.25,5).attr({
					stroke : color[1],
					fill : color[1],
				});
				paper.text(width/1.15,paddingy*1.25,options.path_name_2).attr({
					fill : color[1],
					'font-weight' : 'bold',
					'text-anchor': 'start',
					'font-size' : '13px',
				});
				//Draw axis
				var axis = paper.path("M "+(2*paddingx)+" "+(2*paddingy) +" l 0 " + (height-(4*paddingy)) + " l "+ (width-(4*paddingx)) + " 0").attr({
					stroke : '#b1b1b1',
				});
				//x
				for(var i  = 0; i<month.length; i++){
					paper.path("M " + ((2*paddingx)+(i*((width-(4*paddingx))/(month.length-1)))) + " "+(height-(2*paddingy))+ " l 0 "+4).attr({
						stroke : '#b1b1b1',
					});
					paper.text(((2*paddingx)+(i*((width-(4*paddingx))/(month.length-1)))), (height-(1.5*paddingy)), ""+month[i]);
					paper.path("M " + ((2*paddingx)+(i*((width-(4*paddingx))/(month.length-1)))) + " "+(2*paddingy)+ " l 0 "+(height-(4*paddingy))).attr({
						stroke : '#f1f1f1',
					});
					
				}
				//y
				var y = parseInt(options.y) || 10;
				var max = 0;
				for(var i = 0; i<high.length; i++){
					if(high[i] > max){
						max = high[i];
					}
				}
				for(var i = 0; i<low.length; i++){
					if(low[i] > max){
						max = low[i];
					}
				}
				max = ((parseInt(max/(y-1)))*(y-1))+(y-1);
				for(var i = 0; i<y; i++){
					paper.path("M "+((2*paddingx)-4)+" "+((height-(2*paddingy))-(i*((height-(4*paddingy))/(y-1))))+" l 4 0").attr({
						stroke : '#b1b1b1',
					});
					paper.text(((1.5*paddingx)),((height-(2*paddingy))-(i*((height-(4*paddingy))/(y-1)))),i*(max/(y-1)));
					paper.path("M "+((2*paddingx))+" "+((height-(2*paddingy))-(i*((height-(4*paddingy))/(y-1))))+" l "+ (width-(4*paddingy)) +" 0").attr({
						stroke : '#f1f1f1',
					});
				}
				
				//Draw the high path
				var p = "M "+ (2*paddingx) +" "+ ( (height-(2*paddingy))) +" ";
				var main_path = paper.path(p).attr({
					stroke : color[0],
					'stroke-width' : 3,
				});
				p = "M "+ (2*paddingx) +" "+ ( (height-(2*paddingy)) - ((height-(4*paddingy))*high[0])/max) +" ";		
				for(var i = 1; i<high.length; i++){
					p+= " l "+ (width-(4*paddingx))/(high.length-1) +" "+ ((height-(4*paddingy))*(high[i-1] - high[i]))/max +" " ;
					
				}
				main_path.animate({
						path : p,
				},500, '<>');
				//Draw the low path
				var p = "M "+ (2*paddingx) +" "+ ( (height-(2*paddingy))) +" ";
				var main_path = paper.path(p).attr({
					stroke : color[1],
					'stroke-width' : 3,
				});
				p = "M "+ (2*paddingx) +" "+ ( (height-(2*paddingy)) - ((height-(4*paddingy))*low[0])/max) +" ";		
				for(var i = 1; i<low.length; i++){
					p+= " l "+ (width-(4*paddingx))/(low.length-1) +" "+ ((height-(4*paddingy))*(low[i-1] - low[i]))/max +" " ;					
				}
				main_path.animate({
						path : p,
				},750, '<>');
				//Popup
				var popup_alert = paper.rect(0, 0, 100, 80, 5,).attr({
					fill : "#f9f9f9",
					stroke : '#d9d9d9',
					opacity : 0,
				});
				popup_alert.node.id = 'ppa';
				var popup_alert_text1 = paper.text(0,0, "High : 50").attr({
					stroke : color[0],
					opacity : 0,
					"text-anchor": "start",
					"font-weight": "bold",
				});
				popup_alert_text1.node.id = 'ppat1';
				var popup_alert_text2 = paper.text(0,40, "Low : 10").attr({
					stroke : color[1],
					opacity : 0,
					"text-anchor": "start",
					"font-weight": "bold"
				});
				popup_alert_text2.node.id = 'ppat2';
				
				//Draw the circle for high
				var cxh = new Array();
				var cyh = new Array();
				for(var i = 0; i<high.length; i++){
					var circle = paper.circle(((2*paddingx)+(i*((width-(4*paddingx))/(high.length-1)))) , ( (height-(2*paddingy)) - ((height-(4*paddingy))*high[i])/max), 1.5).attr({
						fill : color[0],
						stroke : color[0],
						opacity : 0,
					});
					circle.node.id = 'h'+i;
					cxh.push(((2*paddingx)+(i*((width-(4*paddingx))/(high.length-1)))));
					cyh.push(( (height-(2*paddingy)) - ((height-(4*paddingy))*high[i])/max));
				}
				//Draw the circle for low
				var cxl = new Array();
				var cyl = new Array();
				for(var i = 0; i<low.length; i++){
					var circle = paper.circle(((2*paddingx)+(i*((width-(4*paddingx))/(low.length-1)))) , ( (height-(2*paddingy)) - ((height-(4*paddingy))*low[i])/max), 1.5).attr({
						fill : color[1],
						stroke : color[1],
						opacity : 0,
					});
					circle.node.id = 'l'+i;
					cxh.push(((2*paddingx)+(i*((width-(4*paddingx))/(low.length-1)))));
					cyh.push(( (height-(2*paddingy)) - ((height-(4*paddingy))*low[i])/max));
	
				}
				//Draw rectangle for popup
				for(var i = 0; i<high.length; i++){
					var x = 2*paddingx - (((width-(4*paddingx))/(high.length-1))/2);
					var rect = paper.rect(x + (i*((width-(4*paddingx))/(high.length-1))), 2*paddingy, ((width-(4*paddingx))/(high.length-1)), height-(4*paddingy)).attr({
						fill : 'red',
						opacity : 0,
					});
					rect.node.id = 'r'+i;
					rect.node.addEventListener('mouseover', popup);
					rect.node.addEventListener('mouseout', popdown);
				};
				function popup(){			
					/*var div = document.getElementById(this.id).getBoundingClientRect();
					console.log(div);*/
					//parseInt(this.id.replace('c','')) ||
					id =  parseInt(this.id.replace('r',''));
					popup_alert_text1.attr({
						text : "High : "+ high[id],
					});
					popup_alert_text2.attr({
						text : "Low : "+ low[id],
					});
					$('#h'+id).animate({
						opacity : 1,
						r : 5,
					}, 200);
					$('#l'+id).animate({
						opacity : 1,
						r : 5,
					}, 200);
					if(id<high.length/2){
						popup_alert.animate({
							x : cxh[id]+7,
							y : cyh[id]-5,
							opacity : 1,
						}, 200);
						
						popup_alert_text1.animate({
							x : cxh[id]+37,
							y : cyh[id]+15,
							opacity : 1,
							transform : 's1.4',
						},200);
						popup_alert_text2.animate({
							x : cxh[id]+37,
							y : cyh[id]+50,
							opacity : 1,
							transform : 's1.4',
						},200);
					}else{
						popup_alert.animate({
							x : cxh[id]-107,
							y : cyh[id]-5,
							opacity : 1,
						}, 200);
						
						popup_alert_text1.animate({
							x : cxh[id]-77,
							y : cyh[id]+15,
							opacity : 1,
							transform : 's1.4',
						},200);
						popup_alert_text2.animate({
							x : cxh[id]-77,
							y : cyh[id]+50,
							opacity : 1,
							transform : 's1.4',
						},200);
					}
					
					
				}
				function popdown(){			
					popup_alert.animate({
						opacity: 0,
					},200);
					popup_alert_text1.animate({
						opacity: 0,
					},200);
					popup_alert_text2.animate({
						opacity: 0,
					},200);
					$('#h'+id).animate({
						opacity : 0,
						r : 0,
					}, 200);
					$('#l'+id).animate({
						opacity : 0,
						r : 0,
					}, 200);
				}
			}else{
				alert("Low temperature datas are incorrect");
			}
		}else{
			alert("High temperature datas are incorrect");
		}
	</script>
    </body>
</html>
